//---------------------------------------------------------------------------

#include <vcl.h>
#pragma hdrstop

#include "AddUnit.h"
#include <string>
#include <stdlib>

//---------------------------------------------------------------------------
#pragma package(smart_init)
#pragma resource "*.dfm"
TFormAdd *FormAdd;
//---------------------------------------------------------------------------
__fastcall TFormAdd::TFormAdd(TComponent* Owner, vector<CPatient> vPatients)
	: TForm(Owner)
{

}
//---------------------------------------------------------------------------
void __fastcall TFormAdd::Button1Click(TObject *Sender)
{
	CPatient add;

	string surname, name;
	int spress, dpress, pulse;

	if(RGRh->ItemIndex)
		add.setRhFactor(false);
	else add.setRhFactor(true);
		char* s;

	try{
		 surname=(AnsiString(LESurname->Text)).c_str();
		 name=AnsiString(LEName->Text).c_str();

		 if(LESurname->Text.IsEmpty())  throw("Поле \"Прізвище\" пусте");
		 if(LEName->Text.IsEmpty()) throw("Поле \"Ім'я\" пусте");

		 for(int i=0; i<surname.size(); i++)
		 {
			if(!isalpha(surname[i]))
			throw("Неправильно введене прізвище");
		 }

		  for(int i=0; i<name.size(); i++)
		 {
			if(!isalpha(name[i]))
			throw("Неправильно введене ім'я");
		 }

         	if(CBGroup->ItemIndex==-1)
			throw("Група крові не обрана");

			if(RGRh->ItemIndex==-1)
			throw("Резус-фактор не обраний");

			if(!TryStrToInt(LESPressure->Text, spress))
			throw("Неправильно введена верхня межа тиску");

			if(!TryStrToInt(LEDPressure->Text, dpress))
			throw("Неправильно введена нижня межа тиску");

			if(!TryStrToInt(LEPulse->Text, pulse))
			throw("Неправильно введений пульс");

		 add.setSurname(surname);
		 add.setName(name);
		 add.setBloodType(CBGroup->ItemIndex+1);
		 if(RGRh->ItemIndex){
			add.setRhFactor(false);
		 }
		 else add.setRhFactor(true);

		 add.setSPressure(spress);
		 add.setDPressure(dpress);
		 add.setPulse(pulse);
	 }
	 catch(const char* message){ShowMessage(message);}

	vPatients.push_back(add);
}
//---------------------------------------------------------------------------


